(function($) {
    $.introLoader = function(element, options) {
        var defaults = {
            animation: {
                name: "gifLoader",
                options: {
                    exitFx: "fadeOut",
                    ease: "linear",
                    style: "light",
                    delayBefore: 500,
                    delayAfter: 0,
                    exitTime: 300,
                    animationTime: 300,
                    customGif: "./css/spinner/circle-bub_dark.gif",
                    customGifBgColor: '#fff',
                    progbarTime: 300,
                    progbarDelayAfter: 300,
                    loaderText: "Website is Ready!",
                    lettersDelayTime: 1,
                    preventScroll: false,
                    fixed: true,
                    stop: true,
                    onAfter: function() {},
                    onBefore: function() {}
                }
            },
            spinJs: {}
        };

        var plugin = this;
        plugin.settings = {};

        var element = $(element);

        plugin.init = function() {
            plugin.settings = $.extend(true, defaults, options);

            var animationName = plugin.settings.animation.name;
            var animationOptions = plugin.settings.animation.options;

            if (animationName === "gifLoader") {
                gifLoader(element, animationOptions);
            }
        };

        plugin.stop = function() {
            if (plugin.settings.animation.name === "gifLoader") {
                stopGifLoader();
            }
        };

        plugin.destroy = function() {
            $(element).removeData();
        };

        // GIF Loader function
        var gifLoader = function(element, options) {
            options.onBefore();
            setupLoader(element, options, "gifLoader");

            var styles = "";
            if (options.customGif) {
                styles = "background-image: url(" + options.customGif + ");";
            }
            styles += options.customGifBgColor ? "background-color:" + options.customGifBgColor + ";" : "";

            var html = "";
            html += '<div id="introLoaderSpinner" class="gifLoaderInner" style="' + styles + '">';
            html += "</div>";

            $(element).html(html);
            $(element).show();

            if (options.stop === true) {
                $(window).on("load", function() {
                    stopGifLoader();
                });
            }
        };

        var stopGifLoader = function() {
            var options = plugin.settings.animation.options;
            exitLoader(options, false);
        };

        // Setup loader
        var setupLoader = function(element, options, className) {
            $(element).hide().removeClass().addClass("introLoaderWrap");
            if (options.preventScroll === true) {
                $("body").addClass("introLoader_preventScroll");
            }

            if (options.fixed === true) {
                $(element).addClass("introLoaderWrap-fixed");
            }

            $(element).addClass(className);
        };

        // Exit loader
        var exitLoader = function(options, stopSpinner) {
            setTimeout(function() {
                if (stopSpinner === true) {
                    // Spinner is not used in this setup
                }

                $(element).find(".introLoaderInner").fadeOut(options.exitTime, function() {
                    $(element).hide();
                    if (options.preventScroll === true) {
                        $("body").removeClass("introLoader_preventScroll");
                    }
                    options.onAfter();
                });
            }, options.delayAfter);
        };

        plugin.init();
    };

    $.fn.introLoader = function(options) {
        return this.each(function() {
            if (undefined == $(this).data("introLoader")) {
                var plugin = new $.introLoader(this, options);
                $(this).data("introLoader", plugin);
            }
        });
    };
})(jQuery);
